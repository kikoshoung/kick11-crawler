INSERT INTO `competition_category`(`name`) SELECT distinct competition_category FROM `transfermarket_competition` WHERE competition_category != '' AND competition_category NOT IN (SELECT name FROM competition_category);

INSERT INTO `competition`(`name`,`category_id`,`type`,`nation_id`) SELECT transfermarket_competition.competition_name,competition_category.id,transfermarket_competition.competition_type,transfermarket_nation.nation_ref_id FROM `transfermarket_competition` JOIN `competition_category` ON competition_category.name = transfermarket_competition.competition_category JOIN `transfermarket_nation` ON transfermarket_competition.nation_id = transfermarket_nation.id WHERE transfermarket_competition.competition_name NOT IN (SELECT `name` FROM `competition`)

INSERT INTO `competition`(`name`,`category_id`,`type`,`nation_id`) SELECT transfermarket_competition.competition_name,competition_category.id,transfermarket_competition.competition_type,0 FROM `transfermarket_competition` JOIN `competition_category` ON competition_category.name = transfermarket_competition.competition_category WHERE transfermarket_competition.nation_id = 0 AND transfermarket_competition.competition_name NOT IN (SELECT `name` FROM `competition`)

UPDATE `transfermarket_competition` JOIN `competition` ON transfermarket_competition.competition_name = competition.name AND transfermarket_competition.nation_id = (SELECT transfermarket_nation.id FROM transfermarket_nation WHERE transfermarket_nation.nation_ref_id = competition.nation_id) SET transfermarket_competition.competition_ref_id = competition.id WHERE transfermarket_competition.competition_ref_id = 0